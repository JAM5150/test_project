<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/default}">

<!-- index.html 고유 CSS 추가 -->
<th:block layout:fragment="css">
	<!--<link rel="stylesheet" th:href="@{/css/page/home.css}" >-->
	<link rel="stylesheet" th:href="@{/css/login.css}">
</th:block>

<!-- index.html 고유 스크립트 추가 -->
<th:block layout:fragment="script">
	<!-- <script th:src="@{/js/page/home.js}"></script>-->
</th:block>

<div layout:fragment="content">
	<script type="text/javascript">
		$(function () {
			$("#forgot").click(function(){
				alert("관리자에게 문의하세요.");
				return false;
			})	
			
			$("#user_id").bind("focus keyup",function(e){
				$(this).val(sliceByByte($(this).val(), 15));
			})
		});
		
		//로그인(Sign in)
		function doSign(f){
			let form = {
				USER_ID: f.user_id.value,
				USER_PW: f.user_pw.value
			}
			$.ajax({
				url : "/user/log-in", 
				data: form,
				method: "POST", 
				dataType: "json",
				statusCode: {
					417: function(){
						console.log("내부 오류.");
					}
				}, 
				success: function(response) {
					//console.log(response);
					if(response.userYn == "Y"){
						$(location).attr("href", "/");
					}else{
						alert("잘못된 ID 또는 PW 입니다.");
						return false;
					}
				}
			});
			
			return false;
		}
		
		//회원가입(Sign up)
		function doSave(f){
			if(f.user_name.value == ''){
				alert("이름을 입력해주세요");
				f.user_name.focus();
				return false;
			}
			if(f.user_id.value == ''){
				alert("ID를 입력해주세요");
				f.user_id.focus();
				return false;
			}
			if(f.user_email.value == ''){
				alert("E-Mail을 입력해주세요");
				f.user_email.focus();
				return false;
			}
			if(f.user_pw.value == ''){
				alert("비밀번호를 입력해주세요");
				f.user_pw.focus();
				return false;
			}
			if(f.re_pw.value == ''){
				alert("비밀번호 재입력을 입력해주세요");
				f.re_pw.focus();
				return false;
			}
			
			if(f.user_pw.value != f.re_pw.value){
				alert("비밀번호 값이 일치하지 않습니다.");
				f.re_pw.focus();
				return false;
			}
			
			if(confirm("저장 하시겠습니까?") == false){
				return false;
			}
			
			let duple = "Y";
			//중복 검사
			restOne("/duple/user/" + f.user_id.value, {}, function (response) {
				duple = response.result[0].DUPLE;
				console.log(response.result[0].DUPLE);
				if (duple == "Y") {
					alert("중복된 ID가 존재합니다.");
				} else {
					// 저장문
					let form = {
						USER_NAME: f.user_name.value,
						USER_ID: f.user_id.value,
						USER_PW: f.user_pw.value,
						USER_EMAIL: f.user_email.value
					}
					console.log(form);
					
					restInsert("/comm/user", form, function (response) {
						// 저장 후
						alert("가입이 완료되었습니다");
					})
						
				}
			})

			
			return false;
		}
		
		
		
	</script>
	<div class="login-wrap">
  <div class="login-html">
    <input id="tab-1" type="radio" name="tab" class="sign-in" checked><label for="tab-1" class="tab">Sign In</label>
    <input id="tab-2" type="radio" name="tab" class="sign-up"><label for="tab-2" class="tab">Sign Up</label>
    <div class="login-form">
      <div class="sign-in-htm">
		<form name="signForm" onsubmit="return doSign(this);">
        <div class="group">
          <label for="user" class="label">ID</label>
          <input id="user" name="user_id" type="text" class="input">
        </div>
        <div class="group">
          <label for="pass" class="label">Password</label>
          <input id="pass" name="user_pw" type="password" class="input" data-type="password">
        </div>
        <div class="group">
          <input id="check" type="checkbox" class="check" checked>
          <label for="check"><span class="icon"></span> Keep me Signed in</label>
        </div>
        <div class="group">
          <input type="submit" class="button" value="Sign In">
        </div>
        </form>
        <div class="hr"></div>
        <div class="foot-lnk">
          <p id="forgot">Forgot Password?</p>
        </div>
      </div>
      <div class="sign-up-htm">
		<form name="editForm" onsubmit="return doSave(this);">
			<div class="group">
				<label for="user_name" class="label">User Name</label>
				<input id="user_name" name="user_name" type="text" class="input">
			</div>
			<div class="group">
				<label for="user_id" class="label">ID</label>
				<input id="user_id" name="user_id" type="text" class="input">
			</div>
			<div class="group">
				<label for="user_email" class="label">Email Address</label>
				<input id="user_email" name="user_email" type="text" class="input">
			</div>
			<div class="group">
				<label for="user_pw" class="label">Password</label>
				<input id="user_pw" name="user_pw" type="password" class="input" data-type="password">
			</div>
			<div class="group">
				<label for="re_pw" class="label">Repeat Password</label>
				<input id="re_pw" name="re_pw" type="password" class="input" data-type="password">
			</div>
		
			<div class="group">
				<input type="submit" class="button" value="Sign Up">
			</div>
		</form>
        <div class="hr"></div>
        <div class="foot-lnk">
          <label for="tab-1">Already Member?</a>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

</html>